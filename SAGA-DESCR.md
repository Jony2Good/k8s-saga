#Реализация паттерна SAGA

*billing-service является единым оркестратором процесса оплаты, резерва товара на складе и доставки.  Сервис отправляет команды, отслеживает ответы и запускает компенсации в случае провала.*

Порядок реализации:

1.	Создание заказа: order-service создаёт заказ в статусе NEW и отправляет команду в billing-service.

2.	Проверка баланса: billing-service в рамках локальной тразакции проверяет наличие средств на счете:
	- Если денег недостаточно, billing-service сразу отправляет в order-service и notification-service событие провала и завершает Saga. Клиент получает письмо об отказе.
	- Если денег достаточно, billing-service списывает сумму и сразу посылает клиенту положительное уведомление («Заказ обрабатывается»). Это позволит клиенту не ждать полного завершения.

3.	Резерв товара: billing-service отправляет команду stock-service «Зарезервировать товары для заказа».
	- Если резерв неудачен (нет товаров), billing-service инициирует компенсацию: возвращает деньги и  уведомляет сервисы о провале заказа. 
	- Если резерв успешен, продолжаем Saga.

4. Логика доставки: billing-service направляет уведомление в delivery-service о бронировании доставки товара.
	- Если бронирование не удалось (в тестовом режима каждая вторая бронь будет с отказом), выполняем компенсацию: отправляется из billing-service в stock-service «Отменить резерв», возвращаются деньги на счёт пользователя и уведомляются order-service и notfication-service о неудаче доставки.
	- Если бронирование успешно, завершаем Saga успехом: все шаги выполнены, обновляем статус заказа и посылаем клиенту письмо об успешном оформлении заказа.
